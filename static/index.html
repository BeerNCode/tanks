<html>
    <head>
        <title>Hey</title>
    </head>
    <body>
        <script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.js"></script>
        <script>
            const canvasSize = 1000;
            const gridSize = 50;
            const rectMargin = 4;

            const colourBasedResources = (data, {x, y}) => {
                const resource = data.resources.find(i => i.x == x && i.y == y);
                if(resource){
                    switch(resource.type){
                        case "health":
                            fill(255, 0, 0);
                            break;
                        case "fuel":
                            fill(0, 255, 0);
                            break;
                        case "bullets":
                            fill(0, 0, 255);
                            break;
                    }
                }
            }

            function drawSquares(data) {
                console.log(data)
                const squareSize = (canvasSize/gridSize) - rectMargin;
                const positions = Array.from(new Array(gridSize)).map((u, x) => {
                    return Array.from(new Array(gridSize)).map((u, y) => {
                        const factor = squareSize + rectMargin;
                        return { x, y, xPos:x* factor, yPos:y* factor }
                    });
                }).flat();
                positions.forEach(p => {
                    if(data){
                        colourBasedResources(data, p);
                    }
                    rect(p.xPos, p.yPos, squareSize, squareSize);
                    fill(255, 255, 255)
                })
            }

            function update() {
                fetch("/api/map")
                    .then(resp => resp.json())
                    .then(data => drawSquares(data))
                    .catch(err => console.log(err))
            }

            function setup() {
                createCanvas(canvasSize, canvasSize)
                update();
                frameRate(1)
            }
            
            function draw() {
                update();
            }
        </script>
    </body>
</html>